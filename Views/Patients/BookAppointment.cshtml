@model AppointAid.ViewModels.BookAppointmentViewModel

<h2>Book Appointment</h2>

<form asp-action="BookAppointment" method="post">
    <input type="hidden" asp-for="ReportId" />
    <input type="hidden" asp-for="PatientId" />

    <div class="form-group">
        <label for="SelectedDoctorId">Choose Doctor</label>
        <select asp-for="SelectedDoctorId" asp-items="Model.Doctors" class="form-control"></select>
    </div>

    <div class="form-group">
        <label for="PreferredDate">Preferred Date</label>
        <input type="date" asp-for="PreferredDate" class="form-control" />
    </div>

    <div class="form-group">
        <label for="PreferredTime">Preferred Time</label>
        <select id="time-select" asp-for="PreferredTime" class="form-control">
            <option value="">Select a time</option>
        </select>
    </div>

    <button type="submit" class="btn btn-primary">Book</button>
</form>

<script>
    document.getElementById("PreferredDate").addEventListener("change", function () {
        const doctorId = document.getElementById("SelectedDoctorId").value;
        const date = this.value;

        fetch(`/Patients/GetAvailableTimes?doctorId=${doctorId}&date=${date}`)
            .then(response => response.json())
            .then(times => {
                const timeSelect = document.getElementById("time-select");
                timeSelect.innerHTML = '<option value="">Select a time</option>';
                times.forEach(t => {
                    timeSelect.innerHTML += `<option value="${t.Time}">${t.Time}</option>`;
                });
            });
    });
</script>